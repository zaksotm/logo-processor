{"ast":null,"code":"/**\n * @author shaozilee\n *\n * Bmp format decoder,support 1bit 4bit 8bit 24bit bmp\n *\n */\nfunction BmpDecoder(buffer, is_with_alpha) {\n  this.pos = 0;\n  this.buffer = buffer;\n  this.is_with_alpha = !!is_with_alpha;\n  this.bottom_up = true;\n  this.flag = this.buffer.toString(\"utf-8\", 0, this.pos += 2);\n  if (this.flag != \"BM\") throw new Error(\"Invalid BMP File\");\n  this.parseHeader();\n  this.parseRGBA();\n}\n\nBmpDecoder.prototype.parseHeader = function () {\n  this.fileSize = this.buffer.readUInt32LE(this.pos);\n  this.pos += 4;\n  this.reserved = this.buffer.readUInt32LE(this.pos);\n  this.pos += 4;\n  this.offset = this.buffer.readUInt32LE(this.pos);\n  this.pos += 4;\n  this.headerSize = this.buffer.readUInt32LE(this.pos);\n  this.pos += 4;\n  this.width = this.buffer.readUInt32LE(this.pos);\n  this.pos += 4;\n  this.height = this.buffer.readInt32LE(this.pos);\n  this.pos += 4;\n  this.planes = this.buffer.readUInt16LE(this.pos);\n  this.pos += 2;\n  this.bitPP = this.buffer.readUInt16LE(this.pos);\n  this.pos += 2;\n  this.compress = this.buffer.readUInt32LE(this.pos);\n  this.pos += 4;\n  this.rawSize = this.buffer.readUInt32LE(this.pos);\n  this.pos += 4;\n  this.hr = this.buffer.readUInt32LE(this.pos);\n  this.pos += 4;\n  this.vr = this.buffer.readUInt32LE(this.pos);\n  this.pos += 4;\n  this.colors = this.buffer.readUInt32LE(this.pos);\n  this.pos += 4;\n  this.importantColors = this.buffer.readUInt32LE(this.pos);\n  this.pos += 4;\n\n  if (this.bitPP === 16 && this.is_with_alpha) {\n    this.bitPP = 15;\n  }\n\n  if (this.bitPP < 15) {\n    var len = this.colors === 0 ? 1 << this.bitPP : this.colors;\n    this.palette = new Array(len);\n\n    for (var i = 0; i < len; i++) {\n      var blue = this.buffer.readUInt8(this.pos++);\n      var green = this.buffer.readUInt8(this.pos++);\n      var red = this.buffer.readUInt8(this.pos++);\n      var quad = this.buffer.readUInt8(this.pos++);\n      this.palette[i] = {\n        red: red,\n        green: green,\n        blue: blue,\n        quad: quad\n      };\n    }\n  }\n\n  if (this.height < 0) {\n    this.height *= -1;\n    this.bottom_up = false;\n  }\n};\n\nBmpDecoder.prototype.parseRGBA = function () {\n  var bitn = \"bit\" + this.bitPP;\n  var len = this.width * this.height * 4;\n  this.data = new Buffer(len);\n  this[bitn]();\n};\n\nBmpDecoder.prototype.bit1 = function () {\n  var xlen = Math.ceil(this.width / 8);\n  var mode = xlen % 4;\n  var y = this.height >= 0 ? this.height - 1 : -this.height;\n\n  for (var y = this.height - 1; y >= 0; y--) {\n    var line = this.bottom_up ? y : this.height - 1 - y;\n\n    for (var x = 0; x < xlen; x++) {\n      var b = this.buffer.readUInt8(this.pos++);\n      var location = line * this.width * 4 + x * 8 * 4;\n\n      for (var i = 0; i < 8; i++) {\n        if (x * 8 + i < this.width) {\n          var rgb = this.palette[b >> 7 - i & 0x1];\n          this.data[location + i * 4] = 0;\n          this.data[location + i * 4 + 1] = rgb.blue;\n          this.data[location + i * 4 + 2] = rgb.green;\n          this.data[location + i * 4 + 3] = rgb.red;\n        } else {\n          break;\n        }\n      }\n    }\n\n    if (mode != 0) {\n      this.pos += 4 - mode;\n    }\n  }\n};\n\nBmpDecoder.prototype.bit4 = function () {\n  //RLE-4\n  if (this.compress == 2) {\n    this.data.fill(0xff);\n    var location = 0;\n    var lines = this.bottom_up ? this.height - 1 : 0;\n    var low_nibble = false; //for all count of pixel\n\n    while (location < this.data.length) {\n      var a = this.buffer.readUInt8(this.pos++);\n      var b = this.buffer.readUInt8(this.pos++); //absolute mode\n\n      if (a == 0) {\n        if (b == 0) {\n          //line end\n          if (this.bottom_up) {\n            lines--;\n          } else {\n            lines++;\n          }\n\n          location = lines * this.width * 4;\n          low_nibble = false;\n          continue;\n        } else if (b == 1) {\n          //image end\n          break;\n        } else if (b == 2) {\n          //offset x,y\n          var x = this.buffer.readUInt8(this.pos++);\n          var y = this.buffer.readUInt8(this.pos++);\n\n          if (this.bottom_up) {\n            lines -= y;\n          } else {\n            lines += y;\n          }\n\n          location += y * this.width * 4 + x * 4;\n        } else {\n          var c = this.buffer.readUInt8(this.pos++);\n\n          for (var i = 0; i < b; i++) {\n            if (low_nibble) {\n              setPixelData.call(this, c & 0x0f);\n            } else {\n              setPixelData.call(this, (c & 0xf0) >> 4);\n            }\n\n            if (i & 1 && i + 1 < b) {\n              c = this.buffer.readUInt8(this.pos++);\n            }\n\n            low_nibble = !low_nibble;\n          }\n\n          if ((b + 1 >> 1 & 1) == 1) {\n            this.pos++;\n          }\n        }\n      } else {\n        //encoded mode\n        for (var i = 0; i < a; i++) {\n          if (low_nibble) {\n            setPixelData.call(this, b & 0x0f);\n          } else {\n            setPixelData.call(this, (b & 0xf0) >> 4);\n          }\n\n          low_nibble = !low_nibble;\n        }\n      }\n    }\n\n    function setPixelData(rgbIndex) {\n      var rgb = this.palette[rgbIndex];\n      this.data[location] = 0;\n      this.data[location + 1] = rgb.blue;\n      this.data[location + 2] = rgb.green;\n      this.data[location + 3] = rgb.red;\n      location += 4;\n    }\n  } else {\n    var xlen = Math.ceil(this.width / 2);\n    var mode = xlen % 4;\n\n    for (var y = this.height - 1; y >= 0; y--) {\n      var line = this.bottom_up ? y : this.height - 1 - y;\n\n      for (var x = 0; x < xlen; x++) {\n        var b = this.buffer.readUInt8(this.pos++);\n        var location = line * this.width * 4 + x * 2 * 4;\n        var before = b >> 4;\n        var after = b & 0x0F;\n        var rgb = this.palette[before];\n        this.data[location] = 0;\n        this.data[location + 1] = rgb.blue;\n        this.data[location + 2] = rgb.green;\n        this.data[location + 3] = rgb.red;\n        if (x * 2 + 1 >= this.width) break;\n        rgb = this.palette[after];\n        this.data[location + 4] = 0;\n        this.data[location + 4 + 1] = rgb.blue;\n        this.data[location + 4 + 2] = rgb.green;\n        this.data[location + 4 + 3] = rgb.red;\n      }\n\n      if (mode != 0) {\n        this.pos += 4 - mode;\n      }\n    }\n  }\n};\n\nBmpDecoder.prototype.bit8 = function () {\n  //RLE-8\n  if (this.compress == 1) {\n    this.data.fill(0xff);\n    var location = 0;\n    var lines = this.bottom_up ? this.height - 1 : 0;\n\n    while (location < this.data.length) {\n      var a = this.buffer.readUInt8(this.pos++);\n      var b = this.buffer.readUInt8(this.pos++); //absolute mode\n\n      if (a == 0) {\n        if (b == 0) {\n          //line end\n          if (this.bottom_up) {\n            lines--;\n          } else {\n            lines++;\n          }\n\n          location = lines * this.width * 4;\n          continue;\n        } else if (b == 1) {\n          //image end\n          break;\n        } else if (b == 2) {\n          //offset x,y\n          var x = this.buffer.readUInt8(this.pos++);\n          var y = this.buffer.readUInt8(this.pos++);\n\n          if (this.bottom_up) {\n            lines -= y;\n          } else {\n            lines += y;\n          }\n\n          location += y * this.width * 4 + x * 4;\n        } else {\n          for (var i = 0; i < b; i++) {\n            var c = this.buffer.readUInt8(this.pos++);\n            setPixelData.call(this, c);\n          }\n\n          if (b & 1 == 1) {\n            this.pos++;\n          }\n        }\n      } else {\n        //encoded mode\n        for (var i = 0; i < a; i++) {\n          setPixelData.call(this, b);\n        }\n      }\n    }\n\n    function setPixelData(rgbIndex) {\n      var rgb = this.palette[rgbIndex];\n      this.data[location] = 0;\n      this.data[location + 1] = rgb.blue;\n      this.data[location + 2] = rgb.green;\n      this.data[location + 3] = rgb.red;\n      location += 4;\n    }\n  } else {\n    var mode = this.width % 4;\n\n    for (var y = this.height - 1; y >= 0; y--) {\n      var line = this.bottom_up ? y : this.height - 1 - y;\n\n      for (var x = 0; x < this.width; x++) {\n        var b = this.buffer.readUInt8(this.pos++);\n        var location = line * this.width * 4 + x * 4;\n\n        if (b < this.palette.length) {\n          var rgb = this.palette[b];\n          this.data[location] = 0;\n          this.data[location + 1] = rgb.blue;\n          this.data[location + 2] = rgb.green;\n          this.data[location + 3] = rgb.red;\n        } else {\n          this.data[location] = 0;\n          this.data[location + 1] = 0xFF;\n          this.data[location + 2] = 0xFF;\n          this.data[location + 3] = 0xFF;\n        }\n      }\n\n      if (mode != 0) {\n        this.pos += 4 - mode;\n      }\n    }\n  }\n};\n\nBmpDecoder.prototype.bit15 = function () {\n  var dif_w = this.width % 3;\n\n  var _11111 = parseInt(\"11111\", 2),\n      _1_5 = _11111;\n\n  for (var y = this.height - 1; y >= 0; y--) {\n    var line = this.bottom_up ? y : this.height - 1 - y;\n\n    for (var x = 0; x < this.width; x++) {\n      var B = this.buffer.readUInt16LE(this.pos);\n      this.pos += 2;\n      var blue = (B & _1_5) / _1_5 * 255 | 0;\n      var green = (B >> 5 & _1_5) / _1_5 * 255 | 0;\n      var red = (B >> 10 & _1_5) / _1_5 * 255 | 0;\n      var alpha = B >> 15 ? 0xFF : 0x00;\n      var location = line * this.width * 4 + x * 4;\n      this.data[location] = alpha;\n      this.data[location + 1] = blue;\n      this.data[location + 2] = green;\n      this.data[location + 3] = red;\n    } //skip extra bytes\n\n\n    this.pos += dif_w;\n  }\n};\n\nBmpDecoder.prototype.bit16 = function () {\n  var dif_w = this.width % 2 * 2; //default xrgb555\n\n  this.maskRed = 0x7C00;\n  this.maskGreen = 0x3E0;\n  this.maskBlue = 0x1F;\n  this.mask0 = 0;\n\n  if (this.compress == 3) {\n    this.maskRed = this.buffer.readUInt32LE(this.pos);\n    this.pos += 4;\n    this.maskGreen = this.buffer.readUInt32LE(this.pos);\n    this.pos += 4;\n    this.maskBlue = this.buffer.readUInt32LE(this.pos);\n    this.pos += 4;\n    this.mask0 = this.buffer.readUInt32LE(this.pos);\n    this.pos += 4;\n  }\n\n  var ns = [0, 0, 0];\n\n  for (var i = 0; i < 16; i++) {\n    if (this.maskRed >> i & 0x01) ns[0]++;\n    if (this.maskGreen >> i & 0x01) ns[1]++;\n    if (this.maskBlue >> i & 0x01) ns[2]++;\n  }\n\n  ns[1] += ns[0];\n  ns[2] += ns[1];\n  ns[0] = 8 - ns[0];\n  ns[1] -= 8;\n  ns[2] -= 8;\n\n  for (var y = this.height - 1; y >= 0; y--) {\n    var line = this.bottom_up ? y : this.height - 1 - y;\n\n    for (var x = 0; x < this.width; x++) {\n      var B = this.buffer.readUInt16LE(this.pos);\n      this.pos += 2;\n      var blue = (B & this.maskBlue) << ns[0];\n      var green = (B & this.maskGreen) >> ns[1];\n      var red = (B & this.maskRed) >> ns[2];\n      var location = line * this.width * 4 + x * 4;\n      this.data[location] = 0;\n      this.data[location + 1] = blue;\n      this.data[location + 2] = green;\n      this.data[location + 3] = red;\n    } //skip extra bytes\n\n\n    this.pos += dif_w;\n  }\n};\n\nBmpDecoder.prototype.bit24 = function () {\n  for (var y = this.height - 1; y >= 0; y--) {\n    var line = this.bottom_up ? y : this.height - 1 - y;\n\n    for (var x = 0; x < this.width; x++) {\n      //Little Endian rgb\n      var blue = this.buffer.readUInt8(this.pos++);\n      var green = this.buffer.readUInt8(this.pos++);\n      var red = this.buffer.readUInt8(this.pos++);\n      var location = line * this.width * 4 + x * 4;\n      this.data[location] = 0;\n      this.data[location + 1] = blue;\n      this.data[location + 2] = green;\n      this.data[location + 3] = red;\n    } //skip extra bytes\n\n\n    this.pos += this.width % 4;\n  }\n};\n/**\n * add 32bit decode func\n * @author soubok\n */\n\n\nBmpDecoder.prototype.bit32 = function () {\n  //BI_BITFIELDS\n  if (this.compress == 3) {\n    this.maskRed = this.buffer.readUInt32LE(this.pos);\n    this.pos += 4;\n    this.maskGreen = this.buffer.readUInt32LE(this.pos);\n    this.pos += 4;\n    this.maskBlue = this.buffer.readUInt32LE(this.pos);\n    this.pos += 4;\n    this.mask0 = this.buffer.readUInt32LE(this.pos);\n    this.pos += 4;\n\n    for (var y = this.height - 1; y >= 0; y--) {\n      var line = this.bottom_up ? y : this.height - 1 - y;\n\n      for (var x = 0; x < this.width; x++) {\n        //Little Endian rgba\n        var alpha = this.buffer.readUInt8(this.pos++);\n        var blue = this.buffer.readUInt8(this.pos++);\n        var green = this.buffer.readUInt8(this.pos++);\n        var red = this.buffer.readUInt8(this.pos++);\n        var location = line * this.width * 4 + x * 4;\n        this.data[location] = alpha;\n        this.data[location + 1] = blue;\n        this.data[location + 2] = green;\n        this.data[location + 3] = red;\n      }\n    }\n  } else {\n    for (var y = this.height - 1; y >= 0; y--) {\n      var line = this.bottom_up ? y : this.height - 1 - y;\n\n      for (var x = 0; x < this.width; x++) {\n        //Little Endian argb\n        var blue = this.buffer.readUInt8(this.pos++);\n        var green = this.buffer.readUInt8(this.pos++);\n        var red = this.buffer.readUInt8(this.pos++);\n        var alpha = this.buffer.readUInt8(this.pos++);\n        var location = line * this.width * 4 + x * 4;\n        this.data[location] = alpha;\n        this.data[location + 1] = blue;\n        this.data[location + 2] = green;\n        this.data[location + 3] = red;\n      }\n    }\n  }\n};\n\nBmpDecoder.prototype.getData = function () {\n  return this.data;\n};\n\nmodule.exports = function (bmpData) {\n  var decoder = new BmpDecoder(bmpData);\n  return decoder;\n};","map":{"version":3,"sources":["/Users/zakstratton/Documents/logo-processor/node_modules/bmp-js/lib/decoder.js"],"names":["BmpDecoder","buffer","is_with_alpha","pos","bottom_up","flag","toString","Error","parseHeader","parseRGBA","prototype","fileSize","readUInt32LE","reserved","offset","headerSize","width","height","readInt32LE","planes","readUInt16LE","bitPP","compress","rawSize","hr","vr","colors","importantColors","len","palette","Array","i","blue","readUInt8","green","red","quad","bitn","data","Buffer","bit1","xlen","Math","ceil","mode","y","line","x","b","location","rgb","bit4","fill","lines","low_nibble","length","a","c","setPixelData","call","rgbIndex","before","after","bit8","bit15","dif_w","_11111","parseInt","_1_5","B","alpha","bit16","maskRed","maskGreen","maskBlue","mask0","ns","bit24","bit32","getData","module","exports","bmpData","decoder"],"mappings":"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","sourcesContent":["/**\n * @author shaozilee\n *\n * Bmp format decoder,support 1bit 4bit 8bit 24bit bmp\n *\n */\n\nfunction BmpDecoder(buffer,is_with_alpha) {\n  this.pos = 0;\n  this.buffer = buffer;\n  this.is_with_alpha = !!is_with_alpha;\n  this.bottom_up = true;\n  this.flag = this.buffer.toString(\"utf-8\", 0, this.pos += 2);\n  if (this.flag != \"BM\") throw new Error(\"Invalid BMP File\");\n  this.parseHeader();\n  this.parseRGBA();\n}\n\nBmpDecoder.prototype.parseHeader = function() {\n  this.fileSize = this.buffer.readUInt32LE(this.pos);\n  this.pos += 4;\n  this.reserved = this.buffer.readUInt32LE(this.pos);\n  this.pos += 4;\n  this.offset = this.buffer.readUInt32LE(this.pos);\n  this.pos += 4;\n  this.headerSize = this.buffer.readUInt32LE(this.pos);\n  this.pos += 4;\n  this.width = this.buffer.readUInt32LE(this.pos);\n  this.pos += 4;\n  this.height = this.buffer.readInt32LE(this.pos);\n  this.pos += 4;\n  this.planes = this.buffer.readUInt16LE(this.pos);\n  this.pos += 2;\n  this.bitPP = this.buffer.readUInt16LE(this.pos);\n  this.pos += 2;\n  this.compress = this.buffer.readUInt32LE(this.pos);\n  this.pos += 4;\n  this.rawSize = this.buffer.readUInt32LE(this.pos);\n  this.pos += 4;\n  this.hr = this.buffer.readUInt32LE(this.pos);\n  this.pos += 4;\n  this.vr = this.buffer.readUInt32LE(this.pos);\n  this.pos += 4;\n  this.colors = this.buffer.readUInt32LE(this.pos);\n  this.pos += 4;\n  this.importantColors = this.buffer.readUInt32LE(this.pos);\n  this.pos += 4;\n\n  if(this.bitPP === 16 && this.is_with_alpha){\n    this.bitPP = 15\n  }\n  if (this.bitPP < 15) {\n    var len = this.colors === 0 ? 1 << this.bitPP : this.colors;\n    this.palette = new Array(len);\n    for (var i = 0; i < len; i++) {\n      var blue = this.buffer.readUInt8(this.pos++);\n      var green = this.buffer.readUInt8(this.pos++);\n      var red = this.buffer.readUInt8(this.pos++);\n      var quad = this.buffer.readUInt8(this.pos++);\n      this.palette[i] = {\n        red: red,\n        green: green,\n        blue: blue,\n        quad: quad\n      };\n    }\n  }\n  if(this.height < 0) {\n    this.height *= -1;\n    this.bottom_up = false;\n  }\n\n}\n\nBmpDecoder.prototype.parseRGBA = function() {\n    var bitn = \"bit\" + this.bitPP;\n    var len = this.width * this.height * 4;\n    this.data = new Buffer(len);\n    this[bitn]();\n};\n\nBmpDecoder.prototype.bit1 = function() {\n  var xlen = Math.ceil(this.width / 8);\n  var mode = xlen%4;\n  var y = this.height >= 0 ? this.height - 1 : -this.height\n  for (var y = this.height - 1; y >= 0; y--) {\n    var line = this.bottom_up ? y : this.height - 1 - y\n    for (var x = 0; x < xlen; x++) {\n      var b = this.buffer.readUInt8(this.pos++);\n      var location = line * this.width * 4 + x*8*4;\n      for (var i = 0; i < 8; i++) {\n        if(x*8+i<this.width){\n          var rgb = this.palette[((b>>(7-i))&0x1)];\n\n          this.data[location+i*4] = 0;\n          this.data[location+i*4 + 1] = rgb.blue;\n          this.data[location+i*4 + 2] = rgb.green;\n          this.data[location+i*4 + 3] = rgb.red;\n\n        }else{\n          break;\n        }\n      }\n    }\n\n    if (mode != 0){\n      this.pos+=(4 - mode);\n    }\n  }\n};\n\nBmpDecoder.prototype.bit4 = function() {\n    //RLE-4\n    if(this.compress == 2){\n        this.data.fill(0xff);\n\n        var location = 0;\n        var lines = this.bottom_up?this.height-1:0;\n        var low_nibble = false;//for all count of pixel\n\n        while(location<this.data.length){\n            var a = this.buffer.readUInt8(this.pos++);\n            var b = this.buffer.readUInt8(this.pos++);\n            //absolute mode\n            if(a == 0){\n                if(b == 0){//line end\n                    if(this.bottom_up){\n                        lines--;\n                    }else{\n                        lines++;\n                    }\n                    location = lines*this.width*4;\n                    low_nibble = false;\n                    continue;\n                }else if(b == 1){//image end\n                    break;\n                }else if(b ==2){\n                    //offset x,y\n                    var x = this.buffer.readUInt8(this.pos++);\n                    var y = this.buffer.readUInt8(this.pos++);\n                    if(this.bottom_up){\n                        lines-=y;\n                    }else{\n                        lines+=y;\n                    }\n\n                    location +=(y*this.width*4+x*4);\n                }else{\n                    var c = this.buffer.readUInt8(this.pos++);\n                    for(var i=0;i<b;i++){\n                        if (low_nibble) {\n                            setPixelData.call(this, (c & 0x0f));\n                        } else {\n                            setPixelData.call(this, (c & 0xf0)>>4);\n                        }\n\n                        if ((i & 1) && (i+1 < b)){\n                            c = this.buffer.readUInt8(this.pos++);\n                        }\n\n                        low_nibble = !low_nibble;\n                    }\n\n                    if ((((b+1) >> 1) & 1 ) == 1){\n                        this.pos++\n                    }\n                }\n\n            }else{//encoded mode\n                for (var i = 0; i < a; i++) {\n                    if (low_nibble) {\n                        setPixelData.call(this, (b & 0x0f));\n                    } else {\n                        setPixelData.call(this, (b & 0xf0)>>4);\n                    }\n                    low_nibble = !low_nibble;\n                }\n            }\n\n        }\n\n\n\n\n        function setPixelData(rgbIndex){\n            var rgb = this.palette[rgbIndex];\n            this.data[location] = 0;\n            this.data[location + 1] = rgb.blue;\n            this.data[location + 2] = rgb.green;\n            this.data[location + 3] = rgb.red;\n            location+=4;\n        }\n    }else{\n\n      var xlen = Math.ceil(this.width/2);\n      var mode = xlen%4;\n      for (var y = this.height - 1; y >= 0; y--) {\n        var line = this.bottom_up ? y : this.height - 1 - y\n        for (var x = 0; x < xlen; x++) {\n          var b = this.buffer.readUInt8(this.pos++);\n          var location = line * this.width * 4 + x*2*4;\n\n          var before = b>>4;\n          var after = b&0x0F;\n\n          var rgb = this.palette[before];\n          this.data[location] = 0;\n          this.data[location + 1] = rgb.blue;\n          this.data[location + 2] = rgb.green;\n          this.data[location + 3] = rgb.red;\n\n\n          if(x*2+1>=this.width)break;\n\n          rgb = this.palette[after];\n\n          this.data[location+4] = 0;\n          this.data[location+4 + 1] = rgb.blue;\n          this.data[location+4 + 2] = rgb.green;\n          this.data[location+4 + 3] = rgb.red;\n\n        }\n\n        if (mode != 0){\n          this.pos+=(4 - mode);\n        }\n      }\n\n    }\n\n};\n\nBmpDecoder.prototype.bit8 = function() {\n    //RLE-8\n    if(this.compress == 1){\n        this.data.fill(0xff);\n\n        var location = 0;\n        var lines = this.bottom_up?this.height-1:0;\n\n        while(location<this.data.length){\n            var a = this.buffer.readUInt8(this.pos++);\n            var b = this.buffer.readUInt8(this.pos++);\n            //absolute mode\n            if(a == 0){\n                if(b == 0){//line end\n                    if(this.bottom_up){\n                        lines--;\n                    }else{\n                        lines++;\n                    }\n                    location = lines*this.width*4;\n                    continue;\n                }else if(b == 1){//image end\n                    break;\n                }else if(b ==2){\n                    //offset x,y\n                    var x = this.buffer.readUInt8(this.pos++);\n                    var y = this.buffer.readUInt8(this.pos++);\n                    if(this.bottom_up){\n                        lines-=y;\n                    }else{\n                        lines+=y;\n                    }\n\n                    location +=(y*this.width*4+x*4);\n                }else{\n                    for(var i=0;i<b;i++){\n                        var c = this.buffer.readUInt8(this.pos++);\n                        setPixelData.call(this, c);\n                    }\n                    if(b&1 == 1){\n                        this.pos++;\n                    }\n\n                }\n\n            }else{//encoded mode\n                for (var i = 0; i < a; i++) {\n                    setPixelData.call(this, b);\n                }\n            }\n\n        }\n\n\n\n\n        function setPixelData(rgbIndex){\n            var rgb = this.palette[rgbIndex];\n            this.data[location] = 0;\n            this.data[location + 1] = rgb.blue;\n            this.data[location + 2] = rgb.green;\n            this.data[location + 3] = rgb.red;\n            location+=4;\n        }\n    }else {\n        var mode = this.width % 4;\n        for (var y = this.height - 1; y >= 0; y--) {\n            var line = this.bottom_up ? y : this.height - 1 - y\n            for (var x = 0; x < this.width; x++) {\n                var b = this.buffer.readUInt8(this.pos++);\n                var location = line * this.width * 4 + x * 4;\n                if (b < this.palette.length) {\n                    var rgb = this.palette[b];\n\n                    this.data[location] = 0;\n                    this.data[location + 1] = rgb.blue;\n                    this.data[location + 2] = rgb.green;\n                    this.data[location + 3] = rgb.red;\n\n                } else {\n                    this.data[location] = 0;\n                    this.data[location + 1] = 0xFF;\n                    this.data[location + 2] = 0xFF;\n                    this.data[location + 3] = 0xFF;\n                }\n            }\n            if (mode != 0) {\n                this.pos += (4 - mode);\n            }\n        }\n    }\n};\n\nBmpDecoder.prototype.bit15 = function() {\n  var dif_w =this.width % 3;\n  var _11111 = parseInt(\"11111\", 2),_1_5 = _11111;\n  for (var y = this.height - 1; y >= 0; y--) {\n    var line = this.bottom_up ? y : this.height - 1 - y\n    for (var x = 0; x < this.width; x++) {\n\n      var B = this.buffer.readUInt16LE(this.pos);\n      this.pos+=2;\n      var blue = (B & _1_5) / _1_5 * 255 | 0;\n      var green = (B >> 5 & _1_5 ) / _1_5 * 255 | 0;\n      var red = (B >> 10 & _1_5) / _1_5 * 255 | 0;\n      var alpha = (B>>15)?0xFF:0x00;\n\n      var location = line * this.width * 4 + x * 4;\n\n      this.data[location] = alpha;\n      this.data[location + 1] = blue;\n      this.data[location + 2] = green;\n      this.data[location + 3] = red;\n    }\n    //skip extra bytes\n    this.pos += dif_w;\n  }\n};\n\nBmpDecoder.prototype.bit16 = function() {\n  var dif_w =(this.width % 2)*2;\n  //default xrgb555\n  this.maskRed = 0x7C00;\n  this.maskGreen = 0x3E0;\n  this.maskBlue =0x1F;\n  this.mask0 = 0;\n\n  if(this.compress == 3){\n    this.maskRed = this.buffer.readUInt32LE(this.pos);\n    this.pos+=4;\n    this.maskGreen = this.buffer.readUInt32LE(this.pos);\n    this.pos+=4;\n    this.maskBlue = this.buffer.readUInt32LE(this.pos);\n    this.pos+=4;\n    this.mask0 = this.buffer.readUInt32LE(this.pos);\n    this.pos+=4;\n  }\n\n\n  var ns=[0,0,0];\n  for (var i=0;i<16;i++){\n    if ((this.maskRed>>i)&0x01) ns[0]++;\n    if ((this.maskGreen>>i)&0x01) ns[1]++;\n    if ((this.maskBlue>>i)&0x01) ns[2]++;\n  }\n  ns[1]+=ns[0]; ns[2]+=ns[1];\tns[0]=8-ns[0]; ns[1]-=8; ns[2]-=8;\n\n  for (var y = this.height - 1; y >= 0; y--) {\n    var line = this.bottom_up ? y : this.height - 1 - y;\n    for (var x = 0; x < this.width; x++) {\n\n      var B = this.buffer.readUInt16LE(this.pos);\n      this.pos+=2;\n\n      var blue = (B&this.maskBlue)<<ns[0];\n      var green = (B&this.maskGreen)>>ns[1];\n      var red = (B&this.maskRed)>>ns[2];\n\n      var location = line * this.width * 4 + x * 4;\n\n      this.data[location] = 0;\n      this.data[location + 1] = blue;\n      this.data[location + 2] = green;\n      this.data[location + 3] = red;\n    }\n    //skip extra bytes\n    this.pos += dif_w;\n  }\n};\n\nBmpDecoder.prototype.bit24 = function() {\n  for (var y = this.height - 1; y >= 0; y--) {\n    var line = this.bottom_up ? y : this.height - 1 - y\n    for (var x = 0; x < this.width; x++) {\n      //Little Endian rgb\n      var blue = this.buffer.readUInt8(this.pos++);\n      var green = this.buffer.readUInt8(this.pos++);\n      var red = this.buffer.readUInt8(this.pos++);\n      var location = line * this.width * 4 + x * 4;\n      this.data[location] = 0;\n      this.data[location + 1] = blue;\n      this.data[location + 2] = green;\n      this.data[location + 3] = red;\n    }\n    //skip extra bytes\n    this.pos += (this.width % 4);\n  }\n\n};\n\n/**\n * add 32bit decode func\n * @author soubok\n */\nBmpDecoder.prototype.bit32 = function() {\n  //BI_BITFIELDS\n  if(this.compress == 3){\n    this.maskRed = this.buffer.readUInt32LE(this.pos);\n    this.pos+=4;\n    this.maskGreen = this.buffer.readUInt32LE(this.pos);\n    this.pos+=4;\n    this.maskBlue = this.buffer.readUInt32LE(this.pos);\n    this.pos+=4;\n    this.mask0 = this.buffer.readUInt32LE(this.pos);\n    this.pos+=4;\n      for (var y = this.height - 1; y >= 0; y--) {\n          var line = this.bottom_up ? y : this.height - 1 - y;\n          for (var x = 0; x < this.width; x++) {\n              //Little Endian rgba\n              var alpha = this.buffer.readUInt8(this.pos++);\n              var blue = this.buffer.readUInt8(this.pos++);\n              var green = this.buffer.readUInt8(this.pos++);\n              var red = this.buffer.readUInt8(this.pos++);\n              var location = line * this.width * 4 + x * 4;\n              this.data[location] = alpha;\n              this.data[location + 1] = blue;\n              this.data[location + 2] = green;\n              this.data[location + 3] = red;\n          }\n      }\n\n  }else{\n      for (var y = this.height - 1; y >= 0; y--) {\n          var line = this.bottom_up ? y : this.height - 1 - y;\n          for (var x = 0; x < this.width; x++) {\n              //Little Endian argb\n              var blue = this.buffer.readUInt8(this.pos++);\n              var green = this.buffer.readUInt8(this.pos++);\n              var red = this.buffer.readUInt8(this.pos++);\n              var alpha = this.buffer.readUInt8(this.pos++);\n              var location = line * this.width * 4 + x * 4;\n              this.data[location] = alpha;\n              this.data[location + 1] = blue;\n              this.data[location + 2] = green;\n              this.data[location + 3] = red;\n          }\n      }\n\n  }\n\n\n\n\n};\n\nBmpDecoder.prototype.getData = function() {\n  return this.data;\n};\n\nmodule.exports = function(bmpData) {\n  var decoder = new BmpDecoder(bmpData);\n  return decoder;\n};\n"]},"metadata":{},"sourceType":"script"}