{"ast":null,"code":"/**\n * @author shaozilee\n *\n * BMP format encoder,encode 24bit BMP\n * Not support quality compression\n *\n */\nfunction BmpEncoder(imgData) {\n  this.buffer = imgData.data;\n  this.width = imgData.width;\n  this.height = imgData.height;\n  this.extraBytes = this.width % 4;\n  this.rgbSize = this.height * (3 * this.width + this.extraBytes);\n  this.headerInfoSize = 40;\n  this.data = [];\n  /******************header***********************/\n\n  this.flag = \"BM\";\n  this.reserved = 0;\n  this.offset = 54;\n  this.fileSize = this.rgbSize + this.offset;\n  this.planes = 1;\n  this.bitPP = 24;\n  this.compress = 0;\n  this.hr = 0;\n  this.vr = 0;\n  this.colors = 0;\n  this.importantColors = 0;\n}\n\nBmpEncoder.prototype.encode = function () {\n  var tempBuffer = new Buffer(this.offset + this.rgbSize);\n  this.pos = 0;\n  tempBuffer.write(this.flag, this.pos, 2);\n  this.pos += 2;\n  tempBuffer.writeUInt32LE(this.fileSize, this.pos);\n  this.pos += 4;\n  tempBuffer.writeUInt32LE(this.reserved, this.pos);\n  this.pos += 4;\n  tempBuffer.writeUInt32LE(this.offset, this.pos);\n  this.pos += 4;\n  tempBuffer.writeUInt32LE(this.headerInfoSize, this.pos);\n  this.pos += 4;\n  tempBuffer.writeUInt32LE(this.width, this.pos);\n  this.pos += 4;\n  tempBuffer.writeInt32LE(-this.height, this.pos);\n  this.pos += 4;\n  tempBuffer.writeUInt16LE(this.planes, this.pos);\n  this.pos += 2;\n  tempBuffer.writeUInt16LE(this.bitPP, this.pos);\n  this.pos += 2;\n  tempBuffer.writeUInt32LE(this.compress, this.pos);\n  this.pos += 4;\n  tempBuffer.writeUInt32LE(this.rgbSize, this.pos);\n  this.pos += 4;\n  tempBuffer.writeUInt32LE(this.hr, this.pos);\n  this.pos += 4;\n  tempBuffer.writeUInt32LE(this.vr, this.pos);\n  this.pos += 4;\n  tempBuffer.writeUInt32LE(this.colors, this.pos);\n  this.pos += 4;\n  tempBuffer.writeUInt32LE(this.importantColors, this.pos);\n  this.pos += 4;\n  var i = 0;\n  var rowBytes = 3 * this.width + this.extraBytes;\n\n  for (var y = 0; y < this.height; y++) {\n    for (var x = 0; x < this.width; x++) {\n      var p = this.pos + y * rowBytes + x * 3;\n      i++; //a\n\n      tempBuffer[p] = this.buffer[i++]; //b\n\n      tempBuffer[p + 1] = this.buffer[i++]; //g\n\n      tempBuffer[p + 2] = this.buffer[i++]; //r\n    }\n\n    if (this.extraBytes > 0) {\n      var fillOffset = this.pos + y * rowBytes + this.width * 3;\n      tempBuffer.fill(0, fillOffset, fillOffset + this.extraBytes);\n    }\n  }\n\n  return tempBuffer;\n};\n\nmodule.exports = function (imgData, quality) {\n  if (typeof quality === 'undefined') quality = 100;\n  var encoder = new BmpEncoder(imgData);\n  var data = encoder.encode();\n  return {\n    data: data,\n    width: imgData.width,\n    height: imgData.height\n  };\n};","map":{"version":3,"sources":["/Users/zakstratton/Documents/logo-processor/node_modules/bmp-js/lib/encoder.js"],"names":["BmpEncoder","imgData","buffer","data","width","height","extraBytes","rgbSize","headerInfoSize","flag","reserved","offset","fileSize","planes","bitPP","compress","hr","vr","colors","importantColors","prototype","encode","tempBuffer","Buffer","pos","write","writeUInt32LE","writeInt32LE","writeUInt16LE","i","rowBytes","y","x","p","fillOffset","fill","module","exports","quality","encoder"],"mappings":"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","sourcesContent":["/**\n * @author shaozilee\n *\n * BMP format encoder,encode 24bit BMP\n * Not support quality compression\n *\n */\n\nfunction BmpEncoder(imgData){\n\tthis.buffer = imgData.data;\n\tthis.width = imgData.width;\n\tthis.height = imgData.height;\n\tthis.extraBytes = this.width%4;\n\tthis.rgbSize = this.height*(3*this.width+this.extraBytes);\n\tthis.headerInfoSize = 40;\n\n\tthis.data = [];\n\t/******************header***********************/\n\tthis.flag = \"BM\";\n\tthis.reserved = 0;\n\tthis.offset = 54;\n\tthis.fileSize = this.rgbSize+this.offset;\n\tthis.planes = 1;\n\tthis.bitPP = 24;\n\tthis.compress = 0;\n\tthis.hr = 0;\n\tthis.vr = 0;\n\tthis.colors = 0;\n\tthis.importantColors = 0;\n}\n\nBmpEncoder.prototype.encode = function() {\n\tvar tempBuffer = new Buffer(this.offset+this.rgbSize);\n\tthis.pos = 0;\n\ttempBuffer.write(this.flag,this.pos,2);this.pos+=2;\n\ttempBuffer.writeUInt32LE(this.fileSize,this.pos);this.pos+=4;\n\ttempBuffer.writeUInt32LE(this.reserved,this.pos);this.pos+=4;\n\ttempBuffer.writeUInt32LE(this.offset,this.pos);this.pos+=4;\n\n\ttempBuffer.writeUInt32LE(this.headerInfoSize,this.pos);this.pos+=4;\n\ttempBuffer.writeUInt32LE(this.width,this.pos);this.pos+=4;\n\ttempBuffer.writeInt32LE(-this.height,this.pos);this.pos+=4;\n\ttempBuffer.writeUInt16LE(this.planes,this.pos);this.pos+=2;\n\ttempBuffer.writeUInt16LE(this.bitPP,this.pos);this.pos+=2;\n\ttempBuffer.writeUInt32LE(this.compress,this.pos);this.pos+=4;\n\ttempBuffer.writeUInt32LE(this.rgbSize,this.pos);this.pos+=4;\n\ttempBuffer.writeUInt32LE(this.hr,this.pos);this.pos+=4;\n\ttempBuffer.writeUInt32LE(this.vr,this.pos);this.pos+=4;\n\ttempBuffer.writeUInt32LE(this.colors,this.pos);this.pos+=4;\n\ttempBuffer.writeUInt32LE(this.importantColors,this.pos);this.pos+=4;\n\n\tvar i=0;\n\tvar rowBytes = 3*this.width+this.extraBytes;\n\n\tfor (var y = 0; y <this.height; y++){\n\t\tfor (var x = 0; x < this.width; x++){\n\t\t\tvar p = this.pos+y*rowBytes+x*3;\n\t\t\ti++;//a\n\t\t\ttempBuffer[p]= this.buffer[i++];//b\n\t\t\ttempBuffer[p+1] = this.buffer[i++];//g\n\t\t\ttempBuffer[p+2]  = this.buffer[i++];//r\n\t\t}\n\t\tif(this.extraBytes>0){\n\t\t\tvar fillOffset = this.pos+y*rowBytes+this.width*3;\n\t\t\ttempBuffer.fill(0,fillOffset,fillOffset+this.extraBytes);\n\t\t}\n\t}\n\n\treturn tempBuffer;\n};\n\nmodule.exports = function(imgData, quality) {\n  if (typeof quality === 'undefined') quality = 100;\n \tvar encoder = new BmpEncoder(imgData);\n\tvar data = encoder.encode();\n  return {\n    data: data,\n    width: imgData.width,\n    height: imgData.height\n  };\n};\n"]},"metadata":{},"sourceType":"script"}